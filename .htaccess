<IfModule !mod_rewrite.c>
	<Files index.php>
		order allow,deny
		deny from all
	</Files>
</IfModule>

<IfModule mod_rewrite.c>
	RewriteEngine On
	RewriteBase /

	# redirect requests from inc to Application/Public
	RewriteRule ^inc(.*)$ /Application/Public$1 [N,L]

	# redirect requests from some-module/inc to Modules/some-module/Public
	RewriteCond $1 !^/?(Modules|Application|Public)
	RewriteRule ^(.+?)\/inc(.*)$ /Modules/$1/Public$2 [N,L]

	# add trailing slash on all but files that exist
	RewriteCond %{REQUEST_FILENAME} !-f
	RewriteCond %{REQUEST_URI} !(.*)/$
	RewriteRule ^(.*)$ $1/ [R=301,L]

	# pass control to index.php
	RewriteCond $1 !^(index\.php|Public|(.+?)/Public|Modules/(.+?)/Public)
	RewriteRule ^(.*)$ /index.php/$1
</IfModule>